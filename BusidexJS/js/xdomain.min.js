(function(n,t){(function(n,t,i){var h,c,r,u,y,a,e,o,l,v,s,f,p=[].slice;c=["open","setRequestHeader","send","abort","getAllResponseHeaders","getResponseHeader","overrideMimeType"];h=["readystatechange","progress","loadstart","loadend","load","error","abort"];r=["readyState","responseText","withCredentials","statusText","status","response","responseType","responseXML","upload"];u=r[0];y=r[1];a=r[2];o=function(n){var t;return t=function(){},t.prototype=n,new t};f=[];s=function(n,t){return t==null&&(t=f.length),f.splice(t,0,n)};e=function(n,t){var f,i,u,e,r,o;t==null&&(t={});switch(typeof n){case"object":i=[];for(u in n)e=n[u],i.push(""+u+":\t"+e);return i.join("\n");case"string":for(i=n.split("\n"),r=0,o=i.length;r<o;r++)f=i[r],/([^:]+):\s*(.+)/.test(f)&&(t[RegExp.$1]||(t[RegExp.$1]=RegExp.$2));return t}};s.headers=e;s.PROPS=r;l=function(t){var i;if(i=n[t],i)return n[t]=function(n){if(typeof n!="string"||/\.XMLHTTP/.test(n))return v(new i(n),i)}};l("ActiveXObject");l("XMLHttpRequest");v=function(n){var ot,st,l,y,ht,tt,it,rt,ut,ct,t,b,k,v,w,ft,s,et,lt,d,g,nt,at,vt,yt;if(f.length===0)return n;for(et={},s={},s[a]=!1,it={},rt={},l={},y={},st=function(t){var i,r,u,f;i={};f=t||{};for(r in f)u=f[r],i[r]=u===n?s:u;return i},s.addEventListener=function(n,t){return(y[n]=y[n]||[]).push(t)},s.removeEventListener=function(n,t){var e,i,r,u,o,f;for(i=-1,f=y[n]||[],r=u=0,o=f.length;u<o;r=++u)e=f[r],e===t&&(i=r);if(i!==-1)return y[n].splice(i,1)},s.dispatchEvent=function(n){return t.trigger(n)},t=o(l),ft={},t.set=function(i,r){var f;if(ft[i]=1,i===u){for(f=[];s[u]<r;)(s[u]++,s[u]!==n[u])&&(t.trigger("readystatechange"),s[u]===1&&t.trigger("loadstart"),s[u]===4?(t.trigger("load"),f.push(t.trigger("loadend"))):f.push(void 0));return f}return s[i]=r},v=o(it),t.setRequestHeader=function(t,i){if(v[t]=i,l.opened)return n.setRequestHeader(t,i)},w=o(rt),t.setResponseHeader=function(n,t){return w[n]=t},k={},b={},t.onChange=function(n,t){return(k[n]=k[n]||[]).push(t)},t.onCall=function(n,t){return(b[n]=b[n]||[]).push(t)},t.trigger=function(n,t){var u,i,f,e,r;for(t==null&&(t={}),n=n.replace(/^on/,""),t.type=n,(e=s["on"+n])!=null&&e.call(s,t),r=y[n]||[],i=0,f=r.length;i<f;i++)u=r[i],u.call(s,t)},t.serialize=function(){var n,u,f,e,o,t,i,h;for(f={},i=0,h=r.length;i<h;i++)u=r[i],f[u]=s[u];o={};for(n in w)t=w[n],o[n]=t;e={};for(n in v)t=v[n],e[n]=t;return{method:l.method,url:l.url,async:l.async,body:l.body,responseHeaders:o,requestHeaders:e,props:f}},t.deserialize=function(n){var i,u,e,r,f,l,o,s,h,c;for(o=["method","url","async","body"],f=0,l=o.length;f<l;f++)u=o[f],n[u]&&(t[u]=n[u]);s=n.responseHeaders||{};for(i in s)r=s[i],t.setResponseHeader(i,r);h=n.requestHeaders||{};for(i in h)r=h[i],t.setRequestHeader(i,r);c=n.props||{};for(e in c)r=c[e],t.set(e,r)},d=0,at=c.length;d<at;d++)tt=c[d],n[tt]&&function(t){return s[t]=function(){var r,h,s,u,f,o,c;r=1<=arguments.length?p.call(arguments,0):[];l.opened=!l.opened&&t==="open";l.sent=!l.sent&&t==="send";switch(t){case"getAllResponseHeaders":return e(w);case"send":l.body=r[0];break;case"open":l.method=r[0];l.url=r[1];l.async=r[2]}for(u=r,s=b[t]||[],o=0,c=s.length;o<c;o++){if(h=s[o],f=h(r),f===!1)return;f&&(u=f)}if(t==="setRequestHeader"){if(it[u[0]]=u[1],v[r[0]]!==i)return}else if(t==="getRequestHeader")return w[u[0]];if(n[t])return n[t].apply(n,u)}}(tt);for(ut=function(){var i,u,t,e,f;try{for(f=[],t=0,e=r.length;t<e;t++)u=r[t],f.push(ct(u,n[u]));return f}catch(o){if(i=o,i.constructor.name==="TypeError")throw i;}},ct=function(t,r){var p,o,h,c,a,y,w,f,b;if(a=et[t],r!==a){if(et[t]=r,t===u){if(r===1)for(h in v)w=v[h],n.setRequestHeader(h,w);r===2&&(l.statusCode=n.status,e(n.getAllResponseHeaders(),rt))}for(o=k[t]||[],f=0,b=o.length;f<b;f++)p=o[f],y=p(r,a),y!==i&&(c=y);if(!ft[t])return s[t]=c===i?r:c}},lt=function(i){return n[i]=function(n){return ut(),t.trigger(i,st(n))}},g=0,vt=h.length;g<vt;g++)ht=h[g],lt("on"+ht);for(ut(),nt=0,yt=f.length;nt<yt;nt++)ot=f[nt],ot.call(null,t);return s};n.xhook=s})(n,t);"use strict";var s,h,c,l,a,v,y,p,f,u,r,w,nt,tt,b,k,i,e,o,it,rt,d,g;for(c=location.protocol+"//"+location.host,i=function(n){return n="xdomain ("+c+"): "+n,console.warn?console.warn(n):alert(n)},d=["postMessage","JSON"],e=0,it=d.length;e<it;e++)if(l=d[e],!n[l]){i("requires '"+l+"' and this browser does not support it");return}for(h="XPING",v=function(){return(Math.random()*Math.pow(2,32)).toString(16)},u=function(n){return/(https?:\/\/[^\/]+)(\/.*)?/.test(n)?{origin:RegExp.$1,path:RegExp.$2}:null},k=function(n){var t;return n instanceof RegExp?n:(t=n.toString().replace(/\W/g,function(n){return"\\"+n}).replace(/\\\*/g,".+"),new RegExp("^"+t+"$"))},p=function(i){return t.addEventListener?n.addEventListener("message",i):n.attachEvent("onmessage",i)},w=function(n){return JSON.stringify(n)},a=function(n){return JSON.parse(n)},tt=function(t){return p(function(n){var p,h,c,b,l,o,r,s,f,v,e,d,y;o=n.origin;s=null;for(c in t){v=t[c];try{if(b=k(c),b.test(o)){s=k(v);break}}catch(g){}}if(!s){i("blocked request from: '"+o+"'");return}if(p=n.source,l=a(n.data),e=l.req,r=u(e.url),!(r&&s.test(r.path))){i("blocked request to path: '"+r.path+"' by regex: "+v);return}f=new XMLHttpRequest;f.open(e.method,e.url);f.onreadystatechange=function(){var u,n,t,i;if(f.readyState===4){for(n={props:{}},i=xhook.PROPS,t=i.length-1;t>=0;t+=-1)r=i[t],r!=="responseXML"&&(n.props[r]=f[r]);return n.responseHeaders=xhook.headers(f.getAllResponseHeaders()),u=w({id:l.id,res:n}),p.postMessage(u,o)}};y=e.requestHeaders;for(h in y)d=y[h],f.setRequestHeader(h,d);return f.send(e.body||null)}),n===n.parent?i("slaves must be in an iframe"):n.parent.postMessage(h,"*")},nt=function(n){return p(function(n){var t;if((t=s.prototype.frames[n.origin])!=null)return t.recieve(n)}),xhook(function(t){t.onCall("open",function(r){var f;if(f=u(r[1]),f&&n[f.origin])return r[2]===!1&&i("sync not supported"),setTimeout(function(){return t.set("readyState",1)}),!1});return t.onCall("send",function(){var r,i;if(i=u(t.url),i&&n[i.origin])return r=new s(i.origin,n[i.origin]),r.send(t.serialize(),function(n){return t.deserialize(n)}),!1})})},s=function(){function n(n,i){if(this.origin=n,this.proxyPath=i,this.frames[this.origin])return this.frames[this.origin];this.frames[this.origin]=this;this.listeners={};this.frame=t.createElement("iframe");this.frame.id=this.frame.name="xdomain-"+v();this.frame.src=this.origin+this.proxyPath;this.frame.setAttribute("style","display:none;");t.body.appendChild(this.frame);this.waits=0;this.ready=!1}return n.prototype.frames={},n.prototype.post=function(n){return this.frame.contentWindow.postMessage(n,this.origin)},n.prototype.listen=function(n,t){if(this.listeners[n])throw"already listening for: "+n;return this.listeners[n]=t},n.prototype.unlisten=function(n){return delete this.listeners[n]},n.prototype.recieve=function(n){var r,t;if(n.data===h){this.ready=!0;return}if(t=a(n.data),r=this.listeners[t.id],!r){i("unkown message ("+t.id+")");return}return this.unlisten(t.id),r(t.res)},n.prototype.send=function(n,t){var i=this;return this.readyCheck(function(){var r;return r=v(),i.listen(r,function(n){return t(n)}),i.post(w({id:r,req:n}))})},n.prototype.readyCheck=function(n){var t=this;if(this.ready===!0)return n();if(this.waits++>=100)throw"Timeout connecting to iframe: "+this.origin;return setTimeout(function(){return t.readyCheck(n)},100)},n}(),n.xdomain=function(n){n&&(n.masters&&tt(n.masters),n.slaves&&nt(n.slaves))},xdomain.origin=c,g=t.getElementsByTagName("script"),o=0,rt=g.length;o<rt;o++)if(r=g[o],/xdomain/.test(r.src)){if(r.hasAttribute("slave")){if(f=u(r.getAttribute("slave")),!f)return;b={};b[f.origin]=f.path;xdomain({slaves:b})}r.hasAttribute("master")&&(y={},y[r.getAttribute("master")]=/./,xdomain({masters:y}))}})(window,document);
//# sourceMappingURL=xdomain.min.js.map