"use strict";function manualLogin(n,t,i,r,u,f,e){var o,s;t.resultData=n;i.User=n;o=i.User!=null?parseInt(i.User.AccountTypeId):0;i.MyBusidexMenuName=parseInt(i.User.AccountTypeId)===ACCT_TYPE_ORGANIZATION?"Edit Referrals":"My Busidex";i.MyBusidexName=i.User!=null&&o===ACCT_TYPE_ORGANIZATION?"Referrals":"My Busidex";i.SearchModel=null;i.LoginModel={LoginText:i.User==null?"Login":"LogOut",LoginRoute:i.User==null?"#/account/login":"#/account/logout",HomeLink:i.User!=null&&i.User.StartPage=="Organization"?"#/groups/organization/"+i.User.Organizations[0].Item2:"#/home"};r.put("User",n);i.IsLoggedIn=i.User!=null;s=i.User!=null?i.User.Token:null;u.defaults.headers.common["X-Authorization-Token"]=s;f.get({},function(n){if(n.SharedCards&&n.SharedCards.length>0){$("#notificationPopup").modal("show");i.HasSharedCards=!0;i.SharedCards=[];for(var r=0;r<n.SharedCards.length;r++)i.SharedCards.push(n.SharedCards[r]);t.SendFromEmail=n.SharedCards[0].SendFromEmail}},function(){});n.StartPage=="Organization"?e.path("/groups/organization/"+n.Organizations[0].Item2):(e.path("/home"),e.url(e.path()),u({method:"GET",url:ROOT+"/mycard/?id="+n.UserId,headers:{"Content-Type":"application/json"}}).success(function(n){if(i.User.AccountTypeId===ACCT_TYPE_PROFESSIONAL||i.User.AccountTypeId===ACCT_TYPE_BETA){var t=n.MyCards[0];t!=null&&(t.Name==null||t.Name.length==0)&&(t.CompanyName==null||t.CompanyName.length==0)?e.path("/card/edit/"+t.CardId):t==null&&e.path("/card/add/mine")}}))}function goToLogin(){window.location.href="#/account/login"}function goToDetails(n){window.location.href="#/card/details/"+n}function SignInController(n){n.signedIn=!1;n.processAuth=function(t){t.access_token?n.signedIn=!0:t.error&&(n.signedIn=!1)};n.signInCallback=function(t){n.$apply(function(){n.processAuth(t)})};n.renderSignInButton=function(){gapi.signin.render("signInButton",{callback:n.signInCallback,clientid:CLIENT_ID,requestvisibleactions:"http://schemas.google.com/AddActivity",scope:"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/userinfo.email",cookiepolicy:"single_host_origin"})};n.start=function(){n.renderSignInButton()};n.start()}function GenericViewCtrl(n,t,i,r,u){var e,f;i.ToggleMenu=function(){i.ShowMenu=showMenu=!showMenu};i.ShowFilterControls=!1;i.User=i.User||r.get("User");i.SharedCards=[];e=i.User!=null?i.User.Token:null;n.defaults.headers.common["X-Authorization-Token"]=e;i.User&&!i.User.Token&&(i.User=null,r.remove("User"));i.MyBusidex=i.MyBusidex||[];i.LoginModel={LoginText:i.User==null?"Login":"LogOut",LoginRoute:i.User==null?"#/account/login":"#/account/logout",HomeLink:i.User!=null&&i.User.StartPage=="Organization"?"#/groups/organization/"+i.User.Organizations[0].Item2:"#/home"};i.IsLoggedIn=i.User!=null;t.Waiting=!1;i.EventSources==null&&u.query({},function(n){i.EventSources=n.EventSources},function(){});i.NavItems={};i.NavItems.Home=!1;i.NavItems.Search=!1;i.NavItems.Add=!1;i.NavItems.Mine=!1;i.NavItems.Groups=!1;i.NavItems.Busidex=!1;i.NavItems.Memberships=!1;i.SetCurrentMenuItem=function(n){for(var t in i.NavItems)i.NavItems.hasOwnProperty(t)&&(i.NavItems[t]=!1);i.NavItems[n]=!0};i.ShowAddCard=function(){return i.IsLoggedIn&&i.User!=null&&!i.User.IsAdmin&&!i.User.HasCard&&(parseInt(i.User.AccountTypeId)===ACCT_TYPE_PROFESSIONAL||parseInt(i.User.AccountTypeId)===ACCT_TYPE_BETA)};f=i.User!=null?parseInt(i.User.AccountTypeId):0;i.MyBusidexMenuName=i.User!=null&&f===ACCT_TYPE_ORGANIZATION?"Edit Referrals":"My Busidex";i.MyBusidexName=i.User!=null&&f===ACCT_TYPE_ORGANIZATION?"Referrals":"My Busidex";i.ShowMemberships=function(){var t=!1,n,r;if(f=i.User!=null?parseInt(i.User.AccountTypeId):0,i.IsLoggedIn&&i.User!=null&&i.User.Organizations!=null&&f!=ACCT_TYPE_ORGANIZATION){n=i.User.Organizations;for(r in n)if(n.hasOwnProperty(r)){t=!0;break}}return t};i.SEOCardNames="";i.HomeHelpShare="Send your card to others so they can have it in their collection and always be up to date.";i.HomeHelpDetails="People could be trying to add your card to their collection. Be sure to include your Name and/or Company Name so your card can be found in a search.";i.HomeHelpTags="Adding Tags helps your card get found in searches. Keep them relevant to what your business is about so people can find you more easily.";i.HomeShareLink="#/busidex/mine?share=true";i.HomeEditLink=i.User!=null&&i.User.HasCard?"#/card/edit/"+i.User.CardId+"?details=true":"#/card/add";i.HomeTagLink=i.User!=null&&i.User.HasCard?"#/card/edit/"+i.User.CardId+"?tags=true":"#/card/add"}function AdminMenuCtrl(n){n.MenuItems=[];n.MenuItems.push({Name:"User List",Link:"#/admin/users"});n.MenuItems.push({Name:"New Cards",Link:"#/admin/newcards"});n.MenuItems.push({Name:"Card Owners",Link:"#/admin/owners"});n.MenuItems.push({Name:"Unowned Cards",Link:"#/admin/unownedcards"});n.MenuItems.push({Name:"Errors",Link:"#/admin/errors"});n.MenuItems.push({Name:"Popular Tags",Link:"#/admin/populartags"});n.MenuItems.push({Name:"System Tags",Link:"#/admin/systemtags"});n.MenuItems.push({Name:"Back to Dashboard",Link:"#/admin/index"});n.IsAdmin=!0}function AdminCtrl(n,t,i,r,u,f){function o(){n.Errors={};u({method:"GET",cache:!1,url:ROOT+"/admin/ApplicationErrors?daysBack="+n.ErrorsDaysBack}).success(function(t){n.Errors=t.Errors;n.Totals.Errors=n.Errors.length;n.Errors.length==0&&(n.Errors=[{Message:"No Errors to report.",InnerException:"",StackTrace:"",ErrorDate:"",UserId:""}]);n.errorGridOptions={data:"Errors",enableCellEdit:!0}}).error(function(){n.Errors=null;n.errorGridOptions={data:"Errors"}})}function s(){u({method:"GET",cache:!1,url:ROOT+"/admin/UserList"}).success(function(t){n.Users=t.Users;n.Totals.Users=n.Users.length;n.userGridOptions={data:"Users"}}).error(function(){n.Users=null;n.userGridOptions={data:"Users"}})}function h(){u({method:"GET",cache:!1,url:ROOT+"/admin/OwnerList"}).success(function(t){n.Owners=t.Users;n.Totals.Owners=n.Owners.length;n.ownerGridOptions={data:"Owners"}}).error(function(){n.Owners=null;n.ownerGridOptions={data:"Owners"}})}function c(){u({method:"GET",cache:!1,url:ROOT+"/admin/newcards?daysBack="+n.NewCardDaysBack}).success(function(t){n.Cards=t.Cards;n.Totals.NewCards=n.Cards!=null?n.Cards.length:0;for(var i=0;i<n.Cards.length;i++)n.Cards[i].Created=new Date(n.Cards[i].Created).toDateString(),n.Cards[i].Updated=new Date(n.Cards[i].Updated).toDateString()}).error(function(){})}function l(){u({method:"GET",cache:!1,url:ROOT+"/admin/populartags"}).success(function(t){var r,i;for(n.Tags=[],n.SortFilter="Tag",n.Reverse=!1,r=[],i=0;i<t.Tags.length;i++)r.push({Tag:t.Tags[i].Tag,Count:t.Tags[i].Count});n.Tags=r;n.Totals.Tags=n.Tags.length}).error(function(){})}function a(){u({method:"GET",cache:!1,url:ROOT+"/admin/systemtags"}).success(function(t){var r,i;for(n.SystemTags=[],n.SortFilter="Tag",n.Reverse=!1,r=[],i=0;i<t.Tags.length;i++)r.push(t.Tags[i]);n.SystemTags=r}).error(function(){})}function y(){u({method:"GET",cache:!1,url:ROOT+"/admin/unownedcards"}).success(function(t){for(var i=0;i<t.Cards.length;i++)t.Cards[i].Created=new Date(t.Cards[i].Created).toDateString(),t.Cards[i].Updated=new Date(t.Cards[i].Updated).toDateString(),t.Cards[i].DateSent=t.Cards[i].LastContactDate==null?"Never":new Date(t.Cards[i].LastContactDate).toDateString(),t.Cards[i].EmailSentTo=t.Cards[i].Email,n.UnownedCards.push(t.Cards[i])}).error(function(){})}function p(){u({method:"GET",cache:!1,url:ROOT+"/admin/AdminCommunication?code=NewsLetter"}).success(function(t){for(var u,r=[],i=0;i<t.Users.length;i++)u={UserName:t.Users[i].UserName,Email:t.Users[i].Email,Selected:!1,LastSharedDate:"(not available)"},r.push(u);n.AllUsers=r;n.EmailTemplate=t.Template;n.EmailTemplate.Subject=n.EmailTemplate.Body="";f.trustAs("css",n.EmailTemplate.Body)}).error(function(){n.AllUsers=null})}function w(){var n=[];n.push("vinbrown2@gmail.com");n.push("vinbrown@cox.net");v(n)}function b(){for(var i=[],t=0;t<n.AllUsers.length;t++)n.AllUsers[t].Selected&&i.push(n.AllUsers[t].Email);v(i)}function v(i){u({method:"POST",cache:!1,data:{Template:n.EmailTemplate,UserId:t.User.UserId,SendTo:i},url:ROOT+"/admin/SendCommunication"}).success(function(){}).error(function(){n.AllUsers=null})}function k(){return n.EmailTemplate==null?"":f.trustAsHtml(n.EmailTemplate.Body)}function d(){n.SelectAll=!n.SelectAll;for(var t=0;t<n.AllUsers.length;t++)n.AllUsers[t].Selected=n.SelectAll}function g(t){n.CurrentPage=t}n.Errors={};n.errorGridOptions={data:"Errors",enableCellEdit:!0,enableColumnResize:!0};n.userGridOptions={data:"Users",enableCellEdit:!0,enableColumnResize:!0};n.ownerGridOptions={data:"Owners",enableCellEdit:!0,enableColumnResize:!0,columnDefs:[{field:"UserId",displayName:"User Id"},{field:"UserName",displayName:"User Name"},{field:"Email",displayName:"Email"},{field:"LastActivityDate",displayName:"Last Activity Date"},{field:"CardFileId",displayName:"Card",cellTemplate:'<div style="height: 80px;"><img src="https://az381524.vo.msecnd.net/cards/{{row.getProperty(col.field)}}" /><\/div>'}],rowHeight:140};n.NewTag="";n.Totals={};n.Totals.NewCards={};n.Totals.Users={};n.Totals.Errors={};n.Totals.Tags={};n.Totals.Owners={};n.CurrentPage=0;n.AllUsers=[];n.SelectAll=!1;n.ToggleSelectAll=d;n.GetHtml=k;n.SendTestCommunication=w;n.SendCommunications=b;n.NewCardDays=[20,30,60,120];n.ErrorsDays=[7,14,21,30,120];n.UnownedCards=[];n.NewCardDaysBack=n.NewCardDays[0];n.ErrorsDaysBack=n.ErrorsDays[0];n.AddSystemTag=function(){u({method:"POST",cache:!1,url:ROOT+"/admin/AddSystemTag?text="+n.NewTag}).success(function(){n.NewTag="";a()}).error(function(){alert("There was a problem adding the new tag")})};var e=6e5;window.i_errors=setInterval(o,e);window.i_users=setInterval(s,e);window.i_owners=setInterval(h,e);window.i_newcards=setInterval(c,e);window.i_popular=setInterval(l,e);window.i_tags=setInterval(a,e);n.SetCurrentPage=g;n.LoadErrors=function(){o()};n.LoadUsers=function(){s()};n.LoadOwners=function(){h()};n.LoadNewCards=function(){c()};n.LoadTags=function(){l()};t.User==null?r.path("/account/login"):(o(),s(),h(),c(),l(),y(),a(),p(),n.SendOwnerEmail=function(n){u({method:"POST",cache:!1,url:ROOT+"/admin/SendOwnerEmails",params:{userId:t.User.UserId,cardId:n.CardId,email:n.EmailSentTo}}).success(function(){alert("Email Sent!");n.SentTo="";n.DateSent=(new Date).toDateString()}).error(function(){alert("There was a problem sending the email.")})})}function AdminEditCtrl(n,t,i,r,u){n.Waiting=!0;n.Cards=[];t.User==null?r.path("/account/login"):(u({method:"GET",cache:!1,url:ROOT+"/admin/UnownedCards"}).success(function(t){for(var i,f=[],r=0;r<t.Cards.length;r++)i=t.Cards[r],f.push({CardId:i.CardId,Name:i.Name,FrontFileId:i.FrontFileId,CompanyName:i.CompanyName,Email:i.Email,PhoneNumber:i.PhoneNumbers[0]!=null?i.PhoneNumbers[0].Number:"",Save:function(){u({method:"PUT",cache:!1,url:ROOT+"/admin/SaveCardInfo",data:this}).success(function(){}).error(function(){})}});n.Cards=f;n.Waiting=!1}).error(function(){}),n.Save=function(){})}function GroupsCtrl(n,t,i,r,u,f,e){function s(t){n.Cards=[];getGroup(t)}f.trackPage(r.path());n.Waiting=!1;n.GetGroup=s;n.Tabs={};n.GroupId=0;t.SetCurrentMenuItem("Groups");t.ShowFilterControls=!1;n.GroupHelp="BusiGroups and Memberships are ways you can organize your cards. Use a BusiGroup if the group is just for you to see. Choose from any card in your Busidex collection to add to the group. Memberships are groups that all members of the group can see. The person that creates the group has control over who is included.";getGroup=function(t){e.get({id:t},function(t){var r,i;for(n.Group={},n.Cards=[],n.Group=t.Model.Busigroup,n.Group.EmailLink="mailto:?bcc=",o(n.Group.Description),r=0;r<t.Model.BusigroupCards.length;r++)i=t.Model.BusigroupCards[r],i.OrientationClass=i.Card.FrontOrientation=="V"?"v_preview":"h_preview",n.Group.EmailLink+=";"+i.Card.Email,n.Cards.push(i)},function(){})};var h=function(t){confirm("Are you sure you want to delete this group?")&&u.remove({id:t},function(){for(var i=0;i<n.Groups.length;i++)if(n.Groups[i].GroupId==t){n.Groups.splice(i,1);break}},function(){})},o=function(t){for(var i in n.Tabs)n.Tabs.hasOwnProperty(i)&&(n.Tabs[i]=!1);n.Tabs[t]=!0};t.User==null?r.path("/account/login"):(u.get({id:t.User.UserId},function(t){n.Groups=t.Model;for(var i=0;i<n.Groups.length;i++)n.Tabs[n.Groups[i].Name]=!1;n.Groups.length>0&&(o(n.Tabs[n.Groups[0].Description]),getGroup(n.Groups[0].GroupId))},function(){}),n.DeleteGroup=h)}function GroupDetailCtrl(n,t,i,r,u,f,e){if(n.Waiting=!1,t.SetCurrentMenuItem("Groups"),n.GroupId=u.current.params.id,t.User==null)r.path("/account/login");else{f.get({id:u.current.params.id},function(t){var r,i;for(n.Group=t.Model.Busigroup,n.Cards=[],r=0;r<t.Model.BusigroupCards.length;r++)i=t.Model.BusigroupCards[r],i.Ready=!0,i.OrientationClass=i.Card.FrontOrientation=="V"?"v_preview":"h_preview",n.Cards.push(i)},function(){});$(document).on("change","textarea.groupNotes",function(){e.update({id:$(this).attr("ucId"),notes:escape($(this).val())},function(){},function(){})})}n.showCards=function(){for(var t=0;t<n.Cards.length;t++)n.Cards[t].Ready=!0}}function CreateGroupCtrl(n,t,i,r,u,f,e){if(n.Waiting=!1,t.IsLoggedIn=t.User!=null,n.ShowSelectedOnly=!1,t.SetCurrentMenuItem("Groups"),n.Group={Description:"",CardIds:[]},t.User==null)r.path("/account/login");else{if(t.MyBusidex&&t.MyBusidex.length!=0){n.MyBusidex=t.MyBusidex;for(var o=0;o<n.MyBusidex.length;o++)n.MyBusidex[o].Selected=!1,n.MyBusidex[o].OrientationClass=n.MyBusidex[o].Card.FrontOrientation=="V"?"v_preview":"h_preview"}else f.get({},function(i){t.MyBusidex=n.MyBusidex=i.MyBusidex.Busidex;for(var r=0;r<n.MyBusidex.length;r++)n.MyBusidex[r].Selected=!1,n.MyBusidex[r].OrientationClass=n.MyBusidex[r].Card.FrontOrientation=="V"?"v_preview":"h_preview"},function(){alert("error")});n.ToggleSelected=function(t){if(t.Selected=!t.Selected,t.Selected==!0)n.Group.CardIds.push(t.Card.CardId);else for(var i=0;i<n.Group.CardIds.length;i++)if(n.Group.CardIds[i]==t.Card.CardId){n.Group.CardIds.splice(i,1);break}};n.save=function(){var i={userId:t.User.UserId,groupTypeId:GROUPTYPE_PERSONAL,id:0,cardIds:n.Group.CardIds.join(),description:n.Group.Description};e.post(i,function(){r.path("/groups/mine")},function(){alert("error")})}}}function EditGroupCtrl(n,t,i,r,u,f,e,o){n.Waiting=!1;t.IsLoggedIn=t.User!=null;n.ShowSelectedOnly=!1;t.SetCurrentMenuItem("Groups");n.Group={GroupId:0,Description:"",CardIds:[]};t.User==null?r.path("/account/login"):(o.get({id:u.current.params.id},function(i){n.Group=i.Model.Busigroup;n.Group.CardIds=[];n.Cards=i.Model.BusigroupCards;f.get({},function(i){var u,r,f,e;for(t.MyBusidex=n.MyBusidex=i.MyBusidex.Busidex,u=0;u<n.MyBusidex.length;u++)for(r=n.MyBusidex[u],r.OrientationClass=r.Card.FrontOrientation=="V"?"v_preview":"h_preview",f=0;f<n.Cards.length;f++)if(e=n.Cards[f],r.CardId==e.CardId){r.Selected=!0;n.Group.CardIds.push(e.CardId);break}},function(){alert("error")})},function(){}),n.ToggleSelected=function(t){if(t.Selected=!t.Selected,t.Selected==!0)n.Group.CardIds.push(t.Card.CardId);else for(var i=0;i<n.Group.CardIds.length;i++)if(n.Group.CardIds[i]==t.Card.CardId){n.Group.CardIds.splice(i,1);break}},n.save=function(){var i={userId:t.User.UserId,groupTypeId:n.Group.GroupTypeId,id:n.Group.GroupId,cardIds:n.Group.CardIds.join(),description:n.Group.Description};e.update(i,function(){r.path("/groups/mine")},function(){alert("error")})})}function OrganizationCtrl(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){function ut(){return t.Organization.Role=="Admin"}function ft(){return t.Organization.Role=="Member"}function et(){o.select({id:t.Organization.OrganizationId},function(n){b(n);w("home")},function(){})}function b(n){if(t.Organization=n.Model||{},t.Organization.LogoFilePath=t.Organization.LogoFilePath+t.Organization.LogoFileName+"."+t.Organization.LogoType,t.Organization.LogoFilePath!=null&&(t.Organization.LogoFilePath=t.Organization.LogoFilePath.replace("http:","https:")),t.Organization.Role=n.OrgRole,t.Organization==null||t.Organization.OrganizationId==0||t.Organization.Name==null&&t.Organization.Description==null&&t.Organization.Url==null&&t.Organization.Phone1==null){w("details");return}t.Organization.Cards=[];t.Organization.CardIds=[];t.Organization.Referrals=[];t.Organization.Groups=n.Groups;for(var i=0;i<t.Organization.Groups.length;i++)t.Tabs["_"+t.Organization.Groups[i].GroupId]=!1;nt();rt();pt()}function ot(n){confirm("Are you sure you want to delete this group?")&&l.remove({id:n},function(){w("home");o.select({id:e.id},function(n){b(n)},function(){})},function(){alert("error")})}function st(){var n=t.CurrentGroup.GroupId,i;n==null&&(n=0);i={userId:t.Organization.OrganizationId,groupTypeId:GROUPTYPE_ORGANIZATION,id:n,cardIds:t.Organization.CardIds.join(),description:t.CurrentGroup.Description};t.CurrentGroup.GroupId>0?l.update(i,function(){t.Tabs.addgroup=!1;o.select({id:e.id},function(n){b(n);t.Tabs["_"+t.CurrentGroup.GroupId]=!0;g(t.CurrentGroup.GroupId);t.EditingGroup=!1},function(){})},function(){alert("error")}):l.post(i,function(){t.Tabs.addgroup=!1;o.select({id:e.id},function(n){b(n);var i=t.Organization.Groups[t.Organization.Groups.length-1].GroupId;g(i);t.Tabs.groupdetails=!0},function(){})},function(){alert("error")})}function ht(){var n,i;for(w("addgroup"),t.EditingGroup=!1,t.CurrentGroup={},t.Organization.CardIds=[],n=0;n<t.Organization.Cards.length;n++)i=t.Organization.Cards[n],i.Selected=!1}function ct(){t.EditingDetails=!0;w("details");t.Tabs.home=!0}function lt(n){var r,i,u,f;for(w("_"+n),t.Tabs.addgroup=!0,t.EditingGroup=!0,t.Organization.CardIds=[],t.CurrentGroup.GroupId=n,r=0;r<t.Organization.Cards.length;r++)for(i=t.Organization.Cards[r],u=0;u<t.CurrentGroup.Cards.length;u++)if(f=t.CurrentGroup.Cards[u],i.Selected=!1,i.CardId==f.CardId){i.Selected=!0;t.Organization.CardIds.push(i.CardId);break}}function at(n){if(n.Selected=!n.Selected,n.Selected==!0)t.MemberReferrals.push(n.CardId);else for(var i=0;i<t.Organization.CardIds.length;i++)if(t.Organization.CardIds[i]==n.CardId){t.MemberReferrals.splice(i,1);break}}function vt(n){if(t.Tabs.addmembers==!0||t.Tabs.addgroup==!0){if(n.Selected=!n.Selected,n.Selected==!0)t.Organization.CardIds.push(n.CardId);else for(var i=0;i<t.Organization.CardIds.length;i++)if(t.Organization.CardIds[i]==n.CardId){t.Organization.CardIds.splice(i,1);break}}else u.path("/card/details/"+n.CardId)}function yt(){w("homepage")}function nt(){t.Organization.Cards=[];o.getMembers({organizationId:t.Organization.OrganizationId},function(n){for(var i,r=0;r<n.Model.length;r++)i=n.Model[r],i.OrientationClass=i.FrontOrientation=="V"?"v_preview":"h_preview",i.Selected=!1,t.Organization.Cards.push(i)},function(){})}function pt(){o.getGuests({organizationId:t.Organization.OrganizationId},function(n){t.Organization.Guests=n.Guests},function(){})}function wt(n,i){n.AddStatus=i;for(var r=0;r<t.Organization.Guests.length;r++)t.Organization.Guests[r].UserCardId==n.UserCardId&&t.Organization.Guests.splice(r,1);p.updateCardStatus(n,function(){},function(){})}function bt(){return t.Organization==null?"":s.trustAsHtml(t.Organization.HomePage)}function tt(){t.Errors=[];t.Organization==null||t.Organization.OrganizationId==null||t.Organization.OrganizationId==0?o.post(t.Organization,function(){t.DetailsSaved=!0;t.EditingDetails=!1;t.Logo!=null?v.UploadFile(t.Logo,ROOT+"/Organization/UpdateLogo?id="+t.Organization.OrganizationId,function(){o.select({id:e.id},function(n){b(n);h(function(){t.DetailsSaved=!1;w("home")},3e3)},function(){})}):o.select({id:e.id},function(n){b(n);h(function(){t.DetailsSaved=!1;w("home")},3e3)},function(){})},function(){}):o.update(t.Organization,function(){t.DetailsSaved=!0;t.EditingDetails=!1;t.Logo!=null?v.UploadFile(t.Logo,ROOT+"/Organization/UpdateLogo?id="+t.Organization.OrganizationId,function(){o.select({id:e.id},function(n){b(n);h(function(){t.DetailsSaved=!1;w("home")},3e3)},function(){})}):o.select({id:e.id},function(n){b(n);h(function(){t.DetailsSaved=!1;w("home")},3e3)},function(){})},function(n){n.status==400&&t.Errors.push(n.data.Message)})}function kt(n){var r=n.CardId,f=n.IsMyCard?"Are you sure you want to leave this organization?":"Are you sure you want to remove this member?",i,u;if(confirm(f))for(i=0;i<t.Organization.Cards.length;i++)if(u=t.Organization.Cards[i],u.CardId==r){t.Organization.Cards.splice(i,1);o.remove({organizationId:t.Organization.OrganizationId,cardId:r},function(){},function(){});break}}function dt(){t.SearchFilter.SearchFilters="";t.MemberSearch.Cards=[];w("addmembers");t.Tabs.members=!0}function gt(){t.Tabs.addmembers=!1}function ni(n){for(var r,i=0;i<t.MemberSearch.Cards.length;i++)if(r=t.MemberSearch.Cards[i],r.CardId==n.CardId){t.MemberSearch.Cards.splice(i,1);n.FrontType=n.FrontFileType;n.OrientationClass=n.FrontOrientationClass;t.Organization.Cards.push(n);o.addMember({organizationId:t.Organization.OrganizationId,cardId:n.CardId},function(){},function(){});break}}function ti(){event.keyCode==13&&it()}function it(){t.Waiting=!0;t.MemberSearch.Cards=[];var n={UserId:i.User.UserId,Criteria:t.MemberSearch.Criteria,SearchText:t.MemberSearch.Criteria,CardType:1};(n.Distance==0||n.Distance==null)&&(n.Distance=25);a.post(n,function(n){var r,i,u;for(t.Waiting=!1,t.MemberSearch.Criteria=n.SearchModel.SearchText,r=0;r<n.SearchModel.Results.length;r++){for(i=n.SearchModel.Results[r],i.FrontOrientationClass=i.FrontOrientation=="V"?"v_preview":"h_preview",u=0;u<t.Organization.Cards.length;u++)if(i.IsMember=!1,t.Organization.Cards[u].CardId==i.CardId){i.IsMember=!0;break}t.MemberSearch.Cards.push(i)}},function(n){t.resultData=n;alert("Getting search results failed.");t.Waiting=!1})}function g(n){if(n==null){nt();w("home");return}c.get({id:n},function(n){var i,r;for(t.Group={},t.Cards=[],t.CurrentGroup=n.Model.Busigroup,t.CurrentGroup.Cards=[],w("_"+t.CurrentGroup.GroupId),t.Tabs.groupdetails=!0,i=0;i<n.Model.BusigroupCards.length;i++)r=n.Model.BusigroupCards[i],r.OrientationClass=r.FrontOrientation=="V"?"v_preview":"h_preview",t.CurrentGroup.Cards.push(r)},function(){})}function rt(){t.Organization.Referrals=[];t.SearchFilter.SearchFilters="";o.getReferrals({organizationId:t.Organization.OrganizationId},function(n){for(var i,r=0;r<n.Model.length;r++)i=n.Model[r],i.ShowControls=!1,i.Notes!=null&&(i.Notes=unescape(i.Notes)),i.OrientationClass=i.Card.FrontOrientation==="V"?"v_preview":"h_preview",t.Organization.Referrals.push(i)},function(){})}function ii(n,i){for(var u,r=0;r<t.Organization.Referrals.length;r++)u=t.Organization.Referrals[r],u.ShowControls=!1;n.ShowControls=i}function ri(){var u,r,n,f;for(t.MemberReferrals=[],u=[],r=0;r<t.MyBusidex.length;r++)n=t.MyBusidex[r],n.Selected&&(f={CardId:n.CardId,SendFrom:i.User.UserId,Email:t.Organization.AdminEmail,ShareWith:t.Organization.UserId,SharedDate:new Date,Accepted:null,Declined:null,Recommendation:n.Recommendation},u.push(f),n.Selected=!1);y.post(u,function(){t.MemberReferrals=[];alert("Your referrals have been submitted to the organization.")},function(){alert("There was a problem sharing your referrals.")})}var k,d,w;if(t.Tabs={},t.Tabs.home=!1,t.Tabs.details=!1,t.Tabs.addmembers=!1,t.Tabs.guests=!1,t.Tabs.members=!1,t.Tabs.addgroup=!1,t.Tabs.referrals=!1,t.Tabs.share=!1,t.Tabs.groupdetails=!1,t.Tabs.homepage=!1,t.Organization={},t.Organization.Groups=[],t.Organization.Referrals=[],t.GetHtml=bt,t.Role="",t.EditDetails=ct,t.CancelEdit=et,t.SaveDetails=tt,t.ShowAddMembers=dt,t.HideAddMembers=gt,t.AddMember=ni,t.RemoveMember=kt,t.EditHomePage=!1,t.EditHomePage=yt,t.SaveHomePage=tt,t.ToggleSelectedOrGoToDetails=vt,t.ToggleReferral=at,t.SaveGroup=st,t.GetGroup=g,t.AddGroup=ht,t.EditGroup=lt,t.DeleteGroup=ot,t.CurrentGroup={},t.EnterSearch=ti,t.DoSearch=it,t.MemberSearch={},t.MemberSearch.Cards=[],t.MemberSearch.Criteria="",t.GetReferrals=rt,t.UpdateGuestStatus=wt,t.SetShowControls=ii,t.ShareReferrals=ri,t.Waiting=!1,t.Logo=null,t.SearchFilter={},t.SearchFilter.SearchFilters="",i.ShowFilterControls=!1,t.Errors=[],t.MemberReferrals=[],t.MyBusidex=[],t.EditingGroup=!1,t.EditingDetails=!1,t.IsOrganizationAdmin=ut,t.IsOrganizationMember=ft,i.MyBusidex==null||i.MyBusidex.length==0)p.get({},function(n){var i,r;for(t.MyBusidex=[],i=0;i<n.MyBusidex.Busidex.length;i++)r=n.MyBusidex.Busidex[i].Card,n.MyBusidex.Busidex[i].OrientationClass=r.FrontOrientation=="V"?"v_preview":"h_preview",r.OwnerId!=null&&(r.PersonalMessage="",t.MyBusidex.push(n.MyBusidex.Busidex[i]))},function(){alert("error")});else for(t.MyBusidex=[],k=0;k<i.MyBusidex.length;k++)d=i.MyBusidex[k],d.OwnerId!=null&&(d.PersonalMessage="",t.MyBusidex.push(model.MyBusidex.Busidex[k]));i.SetCurrentMenuItem("Memberships");o.select({id:e.id},function(n){b(n)},function(){});w=function(n){t.SearchFilter.SearchFilters="";for(var i in t.Tabs)t.Tabs.hasOwnProperty(i)&&(t.Tabs[i]=!1);t.Tabs[n]=!0};t.SetCurrentTab=w;w("home")}function AccountCtrl(n,t,i,r,u,f,e,o,s,h,c,l,a){function v(){f.path("/account/delete")}o.trackPage(f.path());t.IsLoggedIn=t.User!=null;t.ShowFilterControls=!1;n.DeleteAccount=v;t.SetCurrentMenuItem("Account");n.User=t.User;n.Tabs={};n.Tabs.info=!1;n.Tabs.settings=!1;n.Tabs.username=!1;n.Tabs.password=!1;n.Tabs.accounttype=!1;n.Tabs.abuse=!1;n.SetCurrentTab=function(t){for(var i in n.Tabs)n.Tabs.hasOwnProperty(i)&&(n.Tabs[i]=!1);n.Tabs[t]=!0};e.tab=="accounttype"?n.SetCurrentTab("accounttype"):n.SetCurrentTab("info");n.Waiting=!1;n.AccountInfoModel={};n.AccountInfoModel.UserInfo={};n.AccountInfoModel.AccountTypeId=0;n.AccountInfoModel.Saved=n.AccountInfoModel.Error=!1;n.AccountInfoModel.EmailOkToUse="";n.AccountInfoModel.OriginalEmail="";r.get({id:t.User.UserId},function(t){n.AccountInfoModel.UserInfo=t;n.AccountInfoModel.OriginalEmail=t.Email},function(){alert("error")});n.CheckEmailAvailability=function(){if(n.AccountInfoModel.UserInfo.Email==n.OriginalEmail){n.AccountInfoModel.EmailOkToUse="";return}n.AccountInfoModel.UserInfo.Email==undefined||n.AccountInfoModel.UserInfo.Email.length<5||n.AccountInfoModel.UserInfo.Email.length>20||u.get({name:n.AccountInfoModel.UserInfo.Email},function(t){n.AccountInfoModel.EmailOkToUse=t.User==null?"OK":"USED"},function(){alert("There was a problem validating your username")})};n.SaveAccountInfo=function(){n.AccountInfoModel.Saved=!1;r.update(n.AccountInfoModel.UserInfo,function(){n.AccountInfoModel.Saved=!0;a(function(){n.AccountInfoModel.EmailOkToUse="";n.AccountInfoModel.Saved=!1},5e3)},function(){n.AccountInfoModel.Saved=!1})};n.AccountTypeModel={};s.get({id:t.User.UserId},function(t){n.Plans=t.Plans;for(var i=0;i<n.Plans.length;i++)n.Plans[i].Selected=n.Plans[i].AccountTypeId==t.SelectedPlanId,n.Plans[i].Selected&&(n.AccountTypeModel.AccountTypeId=n.Plans[i].AccountTypeId)},function(){});n.SaveAccountType=function(){n.AccountTypeModel.Saved=n.AccountTypeModel.Error=!1;s.update({userAccountId:t.User.UserAccountId,accountTypeId:n.AccountTypeModel.AccountTypeId},function(){n.AccountTypeModel.Saved=!0;t.User.AccountTypeId=n.AccountTypeModel.AccountTypeId;i.put("User",t.User)},function(){n.AccountTypeModel.Saved=!1;n.AccountTypeModel.Error=!0})};n.SettingsInfo={};h.get({id:t.User.UserId},function(i){i.Model.UserId=t.User.UserId;n.SettingsInfo=i.Model},function(){});n.SaveSettings=function(){return h.update(n.SettingsInfo,function(){f.path("/account/index")},function(){alert("settings not changed")}),!0};n.PasswordInfo={};n.PasswordModel={};n.PasswordModel.SavingPassword=!1;n.PasswordModel.PasswordError=!1;n.PasswordModel.Validate=function(){return n.PasswordInfo.OldPassword!=null&&n.PasswordInfo.OldPassword.length>0&&n.PasswordInfo.NewPassword!=null&&n.PasswordInfo.NewPassword.length>0&&n.PasswordInfo.OldPassword!=n.PasswordInfo.NewPassword&&n.PasswordInfo.NewPassword==n.PasswordInfo.ConfirmPassword};c.get(function(i){i.Model.UserId=t.User.UserId;n.PasswordInfo=i.Model},function(){});n.SavePassword=function(){return c.update(n.PasswordInfo,function(){n.PasswordModel.PasswordError=!1;n.PasswordModel.SavingPassword=!0;a(function(){n.PasswordModel.SavingPassword=!1},5e3)},function(){n.PasswordModel.PasswordError=!0;a(function(){n.PasswordModel.PasswordError=!1},5e3)}),!0};n.UserNameModel={};n.UserNameModel.UserName=t.User.UserName;n.UserNameModel.NewUserName="";n.UserNameModel.UserNameOkToUse=!1;n.UserNameChanged=!1;n.BadUserName=!1;n.Error=!1;n.CheckUserNameAvailability=function(){n.UserNameModel.UserName==undefined||n.UserNameModel.UserName.length<5||n.UserNameModel.UserName.length>20||u.get({name:n.UserNameModel.UserName},function(t){n.UserNameModel.UserNameOkToUse=t.User==null?"OK":"USED"},function(){alert("There was a problem validating your username")})};n.SaveUserName=function(){n.UserNameModel.UserNameChanged=!1;n.UserNameModel.BadUserName=!1;n.UserNameModel.Error=!1;l.update({userId:t.User.UserId,name:n.UserNameModel.NewUserName},function(){n.UserNameModel.UserNameChanged=!0;t.User.UserName=n.UserNameModel.NewUserName;n.UserNameModel.UserName=n.UserNameModel.NewUserName;i.put("User",t.User)},function(t){t.status==400||t.status==404?n.UserNameModel.BadUserName=!0:n.UserNameModel.Error=!0})}}function DeleteAccountCtrl(n,t,i,r,u,f){function e(){var t=n.DeleteAccountModel;r.checkUser(t,function(n){r.remove({token:n.Token},function(){u.path("/account/logout")},function(){})},function(t){t.status==401&&n.Model.Errors.push(t.data.Message)})}f.trackPage(u.path());n.User=t.User;n.Model={};n.Model.Errors=[];n.DeleteAccountModel={UserName:"",Password:""};n.DeleteAccount=e}function RegistrationCompleteCtrl(n,t,i,r,u,f,e,o,s){o.trackPage(e.path());n.Waiting=!1;t.IsLoggedIn=t.User!==null;n.RegistrationErrors=[];var h=u.token;f.update({token:h},function(n){var r,u;_gaq.push(["_trackEvent","Registration","Complete",h]);t.User=n;t.User.RememberMe=!1;r=t.User!=null?parseInt(t.User.AccountTypeId):0;t.MyBusidexMenuName=parseInt(t.User.AccountTypeId)===ACCT_TYPE_ORGANIZATION?"Edit Referrals":"My Busidex";t.MyBusidexName=t.User!=null&&r===ACCT_TYPE_ORGANIZATION?"Referrals":"My Busidex";t.SearchModel=null;u=t.User!=null?t.User.Token:null;s.defaults.headers.common["X-Authorization-Token"]=u;t.LoginModel={LoginText:t.User==null?"Login":"LogOut",LoginRoute:t.User==null?"#/account/login":"#/account/logout",HomeLink:t.User!=null&&t.User.StartPage=="Organization"?"#/groups/organization/"+t.User.Organizations[0].Item2:"#/home"};i.put("User",n);t.IsLoggedIn=t.User!=null;t.ShowAddCard()?e.path(n.CardId>0?"/card/edit/"+card.CardId:"/card/add/mine"):e.path("/home")},function(t){(t==null||t.Message==null)&&(t={Message:"There was a problem completing your registration."});n.RegistrationErrors.push(t.Message)})}function RegistrationViewCtrl(n,t,i,r,u,f,e,o,s,h){function a(n){switch(n.ReferredBy){case n.ReferralTypes.Email:case n.ReferralTypes.Shared:case n.ReferralTypes.Personal:n.ReferredBy+=": "+n.ReferredByPerson;break;case n.ReferralTypes.Other:n.ReferredBy+=": "+n.ReferredByOther}}h.trackPage(s.path());n.Waiting=!0;i.IsLoggedIn=i.User!=null;var c=f.current.params.token,l=f.current.params.sId;n.ShowOwnerCard=!1;n.CurrentStep=1;n.RegistrationErrors=[];n.Model={};t.defaults.useXDomain=!0;n.EmailOkToUse="";u.get({id:c},function(t){t.DisplayName="";t.Email="";t.ConfirmEmail="";t.Password="";t.ConfirmPassword="";t.HumanQuestion="How many letters are there in the word Busidex? (Hint: use a number, don't spell out the word.)";t.AccountTypeId=6;t.ShowOwnerCard=t.Card!==null;t.HasBackImage=t.Card!==null&&t.Card.BackFileId.toUpperCase()!="B66FF0EE-E67A-4BBC-AF3B-920CD0DE56C6";t.CardOwnerToken=c;t.PromoCode=e.promo_code;t.PromoCodeValid=!0;t.IsMobile=!1;t.Agree=!1;t.InviteCardToken=l;t.ReferredBy="";t.ReferredByPerson="";t.ReferredByOther="";t.ReferralTypes={Email:"Email",Shared:"Shared",Personal:"Personal",Other:"Other"};t.Card!==null&&(t.FrontOrientationClass=t.Card.FrontOrientation=="H"?"h_preview":"v_preview",t.BackOrientationClass=t.Card.BackOrientation=="H"?"h_preview":"v_preview",t.Card.CompanyName=encodeURIComponent(t.Card.CompanyName),t.Card.Name=encodeURIComponent(t.Card.Name),t.Card.Title=encodeURIComponent(t.Card.Title));n.Model=t;n.Waiting=!1},function(){n.Waiting=!1});n.CheckPromoCode=function(){n.Model.PromoCodeValid=!1};n.CheckEmailAvailability=function(){n.Model.Email==undefined||n.Model.Email.length<5||o.get({name:n.Model.Email},function(t){n.EmailOkToUse=t.User==null?"OK":"USED"},function(){alert("There was a problem validating your email address")})};n.Regsister=function(){a(n.Model);n.RegistrationErrors=[];t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8";t.defaults.headers.post["Access-Control-Allow-Origin"]="local.busidex.com";t.defaults.transformRequest=function(n){return"model="+JSON.stringify(n)};u.post(n.Model,function(n){window.location.href="https://start.busidex.com/#/front?token="+n.Token},function(t){n.RegistrationErrors.push(t.data.Message)})};_gaq.push(["_trackEvent","Registration","Step","Page Load"]);n.SetStep=function(t){n.CurrentStep=t;_gaq.push(["_trackEvent","Registration","Step",t.toString()])};window.location.href.indexOf("local.")<0&&(window.__insp=window.__insp||[],__insp.push(["wid",128335322]),function(){function n(){var n=document.createElement("script"),t;n.type="text/javascript";n.async=!0;n.id="inspsync";n.src=("https:"==document.location.protocol?"https":"http")+"://cdn.inspectlet.com/inspectlet.js";t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(n,t)}window.attachEvent?window.attachEvent("onload",n):window.addEventListener("load",n,!1)}())}function HomeViewCtrl(n,t,i,r,u,f,e,o){function s(i){if(t.User==null){u.path("/account/login");return}e.post({userId:t.User.UserId,cId:i},function(){alert("This card is now in your Busidex!");n.ExistsInMyBusidex=!0},function(){return alert("There was a problem adding this card to your Busidex"),!1})}t.ShowFilterControls=!1;n.model={};n.model.FeaturedCard=null;n.AddToMyBusidex=s;n.ExistsInMyBusidex=!1;n.TrackEvent=function(n,t){_gaq.push(["_trackEvent","Home","Feature",n]);o.open(t)};f.get({},function(t){n.model.FeaturedCard=t.FeaturedCard},function(){});t.SetCurrentMenuItem("Home")}function LogoutViewCtrl(n,t,i,r){i.remove("User");t.User=n.User=null;t.MyBusidex=null;t.HasSharedCards=!1;t.SharedCards=[];t.IsLoggedIn=!1;t.SearchModel=null;gapi.auth.signOut();t.LoginModel={LoginText:"Login",LoginRoute:"#/account/login",HomeLink:"#/home"};r.path("/home")}function LoginPartialViewCtrl(n,t){t.MyBusidex=t.MyBusidex||[];n.Waiting=!1;t.IsLoggedIn=t.User!=null}function LoginViewCtrl(n,t,i,r,u,f,e,o){n.lastForm={};n.form={UserName:"",Password:"",Token:o._t,EventTag:o._e,AcceptSharedCards:o._a||!1};t.User=null;n.sendForm=function(o){n.Waiting=!0;n.lastForm=angular.copy(o);n.LoginErrors=[];f.post(n.form,function(f){var o,s,h;n.Waiting=!1;n.resultData=f;t.User=f;t.User.RememberMe=n.form.RememberMe;o=t.User!=null?parseInt(t.User.AccountTypeId):0;t.MyBusidexMenuName=parseInt(t.User.AccountTypeId)===ACCT_TYPE_ORGANIZATION?"Edit Referrals":"My Busidex";t.MyBusidexName=t.User!=null&&o===ACCT_TYPE_ORGANIZATION?"Referrals":"My Busidex";t.HomeShareLink="#/busidex/mine?share=true";t.HomeEditLink=t.User!=null&&t.User.HasCard?"#/card/edit/"+t.User.CardId+"?details=true":"#/card/add";t.HomeTagLink=t.User!=null&&t.User.HasCard?"#/card/edit/"+t.User.CardId+"?tags=true":"#/card/add";t.SearchModel=null;t.LoginModel={LoginText:t.User==null?"Login":"LogOut",LoginRoute:t.User==null?"#/account/login":"#/account/logout",HomeLink:t.User!=null&&t.User.StartPage=="Organization"?"#/groups/organization/"+t.User.Organizations[0].Item2:"#/home"};s={domain:"busidex.com",path:"busidex.com",secure:!0};r.put("User",f,s);t.IsLoggedIn=t.User!=null;h=t.User!=null?t.User.Token:null;i.defaults.headers.common["X-Authorization-Token"]=h;e.get({},function(i){if(i.SharedCards&&i.SharedCards.length>0){$("#notificationPopup").modal("show");t.HasSharedCards=!0;t.SharedCards=[];for(var r=0;r<i.SharedCards.length;r++)t.SharedCards.push(i.SharedCards[r]);n.SendFromEmail=i.SharedCards[0].SendFromEmail}},function(){});f.StartPage=="Organization"?u.path("/groups/organization/"+f.Organizations[0].Item2):(u.path("/home"),u.url(u.path()),i({method:"GET",url:ROOT+"/mycard/?id="+f.UserId,headers:{"Content-Type":"application/json"}}).success(function(n){if(t.User.AccountTypeId===ACCT_TYPE_PROFESSIONAL||t.User.AccountTypeId===ACCT_TYPE_BETA){var i=n.MyCards[0];i!=null&&(i.Name==null||i.Name.length==0)&&(i.CompanyName==null||i.CompanyName.length==0)?u.path("/card/edit/"+i.CardId):i==null&&u.path("/card/add/mine")}}))},function(t){t.status==404?n.LoginErrors.push("Username or password is incorrect"):n.LoginErrors.push(t.data.Message);n.Waiting=!1})};n.resetForm=function(){n.form=angular.copy(n.lastForm)}}function ConfirmCardCtrl(n,t){n.Token=t.current.params.token}function AddCardCtrl(n,t,i,r,u,f,e,o,s,h,c,l,a,v){var y,p;if(a.trackPage(r.path()),t.User==null&&r.path("/account/login"),n.Card={},n.Tabs={},t.ShowFilterControls=!1,y="b66ff0ee-e67a-4bbc-af3b-920cd0de56c6",n.Tabs.terms=!1,n.Tabs.details=!1,n.Tabs.tags=!1,n.Tabs.notes=!1,n.Tabs.mycard=!1,n.Tabs.address=!1,n.Tabs.phone=!1,n.Tabs.scorecard=!1,t.IsLoggedIn=t.User!=null,n.files=[],n.files.push(""),n.files.push(""),n.FileError=!1,n.acceptingTerms=!1,n.ModelError=!1,n.Title="",n.$on("fileSelected",function(t,i){n.IsBound||n.$apply(function(){var f,t,u,r;for(n.IsBound=!0,f=i.file.type,t=[],t.push("jpg"),t.push("gif"),t.push("jpeg"),t.push("png"),t.push("bmp"),u=!1,r=0;r<t.length;r++)if(f.indexOf(t[r])>=0){u=!0;break}if(!u)return alert("Sorry, only jpg, gif, png and bmp files are supported"),!1;n.files[i.idx]=i.file;n.ImagePreview(i.idx);i.idx==0&&(n.Model.HasFrontImage=!0);i.idx==1&&(n.Model.HasBackImage=!0)})}),n.Model={},n.TagHelp="Adding Tags helps your card get found in searches. Keep them relevant to what your business is about so people can find you more easily.",n.DetailsHelp="Be sure to include your Name and/or Company Name so your card can be found in a search.",n.Model.IsValid=!0,n.Model.Errors=[],n.ExistingCards=[],t.User.AccountTypeId!=5&&t.User.AccountTypeId!=6){r.path("/");return}n.CalculateProgress=function(){var t=0,i;return(n.Model.FrontImage!=null||n.Model.HasFrontImage)&&(t+=10),(n.Model.BackImage!=null||n.Model.HasBackImage)&&(t+=10),n.Model.Name!=null&&n.Model.Name.length>0&&(t+=10),n.Model.CompanyName!=null&&n.Model.CompanyName.length>0&&(t+=10),n.Model.Title!=null&&n.Model.Title.length>0&&(t+=5),n.Model.Email!=null&&n.Model.Email.length>0&&(t+=10),n.Model.Url!=null&&n.Model.Url.length>0&&(t+=5),n.Model.PhoneNumbers!=null&&n.Model.PhoneNumbers.length>0&&n.Model.PhoneNumbers[0].Number.length>0&&(t+=10),n.Model.Addresses!=null&&n.Model.Addresses.length>0&&(i=n.Model.Addresses[0],i.Address1!=null&&i.Address1.length>0&&(t+=5),i.Address2!=null&&i.Address2.length>0&&(t+=3),i.City!=null&&i.City.length>0&&(t+=5),i.State!=null&&i.State.StateCodeId>0&&(t+=5),i.ZipCode!=null&&i.ZipCode.length>0&&(t+=5)),n.Model.Tags!=null&&n.Model.Tags.length>0&&(t+=n.Model.Tags.length),t>100&&(t=100),t};p=function(){var f={id:e.id||1,userId:t.User.UserId};n.Waiting=!0;u({method:"GET",url:ROOT+"/card/?id="+f.id+"&userId="+f.userId,data:JSON.stringify(f),headers:{"Content-Type":"application/json"}}).success(function(c){var w,a,p,b;for(c.Model.CardId==0&&(c.Model.FrontFileId=c.Model.BackFileId=y,c.Model.FrontType=c.Model.BackType="png"),c.Model.FrontFileId!=null&&c.Model.FrontFileId.length>0&&(c.Model.FrontFileId="https://az381524.vo.msecnd.net/cards/"+c.Model.FrontFileId+"."+c.Model.FrontType.replace(".","")),c.Model.BackFileId!=null&&c.Model.BackFileId.length>0&&(c.Model.BackFileId="https://az381524.vo.msecnd.net/cards/"+c.Model.BackFileId+"."+c.Model.BackType.replace(".","")),w=[],a=0,a=0;a<c.Model.Addresses.length;a++)p=c.Model.Addresses[a],w.push(new Address(p.CardAddressId,p.CardId,p.Address1,p.Address2,p.City,p.State,p.ZipCode));for(c.Model.Addresses=w,c.Model.Notes=unescape(c.Model.Notes),n.FrontOrientationClass=c.Model.FrontOrientation=="V"?"v_preview":"h_preview",n.BackOrientationClass=c.Model.BackOrientation=="V"?"v_preview":"h_preview",n.UserId=t.User.UserId,c.Model.Visibility=c.Model.Visibility||1,c.Model.Visibility==0&&(c.Model.Visibility=1),n.Model=c.Model,n.Model.TagTypes=[],n.Model.TagTypes.push(""),n.Model.TagTypes.push("User"),n.Model.TagTypes.push("System"),n.Model.Errors=[],n.Model.Progress=55,f.id<=1&&(n.Model.IsMyCard=r.$$path=="/card/add/mine"),b=n.Model.IsMyCard?"MY":"A",n.Title=(f.id==0||f.id==1?"ADD "+b:"EDIT "+b)+" BUSINESS CARD",n.Waiting=!1,n.Model.PhoneNumberTypes=o,n.Model.StateCodes=s,n.Model.FileSizeInfoContent=h,n.Model.PhoneValid=!0,n.Model.IsValid=!0,n.Model.ResetBackImage=!1,n.Model.Notes.toLowerCase()=="null"&&(n.Model.Notes=""),n.ModelReset=c.Model,a=0;a<s.length;a++)if(s[a].StateCodeId==n.Model.Addresses[0].State.StateCodeId){n.Model.Addresses[0].State=s[a];break}n.Model.AddPhoneNumber=function(){for(a=0;a<n.Model.PhoneNumbers.length;a++)if(n.Model.PhoneNumbers[a].PhoneNumberTypeId==null)return n.Model.PhoneValid=!1,!1;return n.Model.PhoneValid=!0,n.Model.PhoneNumbers.push({Number:"",PhoneNumberId:0,PhoneNumberTypeId:0,PhoneNumberType:{PhoneNumberTypeId:0,Name:"",Deleted:!1},Extension:"",Deleted:!1,Selected:!1}),!0};n.Model.RemovePhoneNumber=function(t){if(n.Model.PhoneNumbers.length!=1)for(a=0;a<n.Model.PhoneNumbers.length;a++)if(n.Model.PhoneNumbers[a].Number==t){n.Model.PhoneNumbers[a].Deleted=!0;break}};n.Model.Validate=function(){return n.Model.IsValid=!0,n.Model.Email==null||n.Model.Email.length==0?(n.Model.IsValid=!1,n.SetCurrentTab("details")):n.Model.CardId<=1&&(n.files.length==0||n.files[0].length==0)?(n.Model.IsValid=!1,n.SetCurrentTab("mycard")):(n.Model.PhoneNumbers.length==0||n.Model.PhoneNumbers[0].Number.length==0)&&(n.Model.IsValid=!1,n.SetCurrentTab("phone")),n.Model.IsValid};n.Model.NewCardSaved=!1;n.Model.AddAddress=function(){var t=n.TempAddress,r=t.Address1+t.Address2+t.City+t.State.Code+t.ZipCode+t.Region+t.Country,i;if(r.length!=0){for(i=-1,a=0;a<n.Model.Addresses.length;a++)if(n.Model.Addresses[a].Selected==!0){i=a;break}i>=0?(n.Model.Addresses[i].CardAddressId=t.CardAddressId,n.Model.Addresses[i].CardId=t.CardId,n.Model.Addresses[i].Address1=t.Address1,n.Model.Addresses[i].Address2=t.Address2,n.Model.Addresses[i].City=t.City,n.Model.Addresses[i].State=t.State,n.Model.Addresses[i].ZipCode=t.ZipCode,n.Model.Addresses[i].Region=t.Region,n.Model.Addresses[i].Country=t.Country,n.Model.Addresses[i].Selected=!1):n.Model.Addresses.push(new Address(t.CardAddressId,t.CardId,t.Address1,t.Address2,t.City,t.State,t.ZipCode,t.Region,t.Country));n.TempAddress=new Address(n.Model.Addresses.length,0,"","","",{StateCodeId:-1,Code:"",Name:""},"","","")}};n.Save=function(){if(n.FileError=!1,n.Model.UserId=t.User.UserId,!n.Model.Validate())return!1;n.Model.ResetBackImage==!0&&(n.Model.BackFileId=null);var f={id:e.id||1,userId:t.User.UserId},o=n.Model.CardId>1;return u({method:o?"PUT":"POST",url:ROOT+"/card/?id="+f.id+"&userId="+f.userId,headers:{"Content-Type":undefined,"Access-Control-Allow-Headers":"Content-Type"},transformRequest:function(){var r=new FormData,i=n.Model,u,f,t;for(i.FrontFileId=i.BackFileId=i.FrontImage=i.BackImage=null,u=i.IsMyCard,i.IsMyCard=u=="1"?!0:!1,f=[],a=0;a<i.Addresses.length;a++)t=i.Addresses[a],f.push(new Address(t.CardAddressId,t.CardId,t.Address1,t.Address2,t.City,t.State,t.ZipCode)),t.State={Code:t.State.Code,StateCodeId:t.State.StateCodeId,Name:t.State.Name};return r.append("model",angular.toJson(i)),r.append("file0",n.files[0]||""),r.append("file1",n.files[1]||""),i.Addresses=f,i.IsMyCard=u,r},data:{model:n.model,files:n.files}}).success(function(){for(t.MyBusidex=[],t.User.HasCard=!0,i.put("User",t.User),n.Model.Progress=n.CalculateProgress(),a=0;a<s.length;a++)if(s[a].StateCodeId==n.Model.Addresses[0].State.StateCodeId){n.Model.Addresses[0].State=s[a];break}n.Model.NewCardSaved=!0;l(function(){o?n.Model.NewCardSaved=!1:r.path("/busidex/mine")},5e3)}).error(function(t,i){if(n.resultData=t,n.Model.SelectedExistingCardId=0,i==400){if(n.ExistingCards.length==0)for(var r in t.Model.ErrorCollection)n.Model.Errors.push(t.Model.ErrorCollection[r])}else alert("There was a problem saving your card.")}),!1};n.Model.EditAddress=function(t){for(a=0;a<n.Model.Addresses.length;a++)if(n.Model.Addresses[a].CardAddressId==t){var i=n.Model.Addresses[a];n.TempAddress=new Address(i.CardAddressId,i.CardId,i.Address1,i.Address2,i.City,i.State,i.ZipCode,i.Region,i.Country);n.Model.Addresses[a].Selected=!0;break}};n.Model.ToggleAddress=function(t){for(a=0;a<n.Model.Addresses.length;a++)if(n.Model.Addresses[a].CardAddressId==t){n.Model.Addresses[a].Deleted=!n.Model.Addresses[a].Deleted;n.Model.Addresses[a].DeleteSrc=n.Model.Addresses[a].Deleted?"../../img/undoDelete.png":"../../img/delete.png";break}};n.Model.AddTag=function(){var t=!1,i=n.Model.NewTag;for(a=0;a<n.Model.Tags.length;a++)if(n.Model.Tags[a].Text==i){t=!0;break}t||n.Model.Tags.push({Text:i,TagType:1});n.Model.NewTag=""};n.Model.RemoveTag=function(t){for(a=0;a<n.Model.Tags.length;a++)if(n.Model.Tags[a].Text==t){n.Model.Tags.splice(a,1);break}};n.Model!=null&&(n.Model.Name==null||n.Model.Name.length==0)&&(n.Model.CompanyName==null||n.Model.CompanyName.length==0)?n.SetCurrentTab("details"):(e.tags&&n.SetCurrentTab("tags"),e.details&&n.SetCurrentTab("details"),e.mycard&&n.SetCurrentTab("mycard"));v.getTerms(function(t){t!==null&&t!=undefined&&t.length>0?n.SetCurrentTab("details"):n.SetCurrentTab("terms")},function(){})}).error(function(t){n.resultData=t;alert("Getting card failed.")})};n.NoDetails=function(){return(n.Model.Name==null||n.Model.Name.length==0)&&(n.Model.CompanyName==null||n.Model.CompanyName.length==0)};n.ClearExisting=function(){n.Model.SelectedExistingCardId=0;n.ExistingCards=[]};n.SetSelectedExistingCardId=function(t){n.Model.SelectedExistingCardId=t};n.AddExistingCard=function(){n.Model.SelectedExistingCardId>0&&c.post({userId:t.User.UserId,cId:n.Model.SelectedExistingCardId},function(){alert("This card is now in your Busidex!");n.ClearExisting();r.path("busidex/mine")},function(){return alert("There was a problem adding this card to your Busidex"),!1})};n.ImagePreview=function(t){n.FileError=!1;u({method:"POST",cache:!1,url:ROOT+"/card/ImagePreview/?idx="+t,headers:{"Content-Type":undefined},transformRequest:function(n){var t=new FormData;return t.append("file0",n.files[0]),n.files.length==2&&t.append("file1",n.files[1]),t},data:{files:n.files}}).success(function(i){t==0&&(n.Model.FrontFileId="data:image/gif;base64,"+JSON.parse(i));t==1&&(n.Model.BackFileId="data:image/gif;base64,"+JSON.parse(i))}).error(function(){return n.FileError=!0,n.files[t]=null,parseInt(t)===0?(n.Model.FrontImage=null,$("#getFrontImgHdn").val(null)):(n.Model.BackImage=null,$("#getBackImgHdn").val(null)),!1})};n.SetCurrentTab=function(t){for(var i in n.Tabs)n.Tabs.hasOwnProperty(i)&&(n.Tabs[i]=!1);n.Tabs[t]=!0};n.Reset=function(){p()};n.ResetBackImage=function(){n.Model.ResetBackImage=!0;n.Model.BackFileId="https://az381524.vo.msecnd.net/cards/"+y+".png"};n.accept_terms=function(){n.acceptingTerms=!0;v.acceptTerms({},function(){n.acceptingTerms=!1;n.SetCurrentTab("details")},function(){})};t.User==null?r.path("/account/login"):p()}function MyBusidexCtrl(n,t,i,r,u,f,e,o,s,h){s.trackPage(r.path());t.IsSharing=!1;t.ToggleSharing=function(){t.IsSharing=!t.IsSharing;t.IsSharing||(n.ShareWithEmail="",n.SharedCardIds={})};t.SetCurrentMenuItem("Busidex");n.data={};n.data.TotalToShow=20;n.data.ShowMore=function(i){n.data.TotalToShow<=t.MyBusidex.length&&(n.data.TotalToShow+=i)};n.SharedCardIds={};n.Waiting=!0;n.Error=!1;n.AddActivity=function(n,i){var r={CardId:i,UserId:t.User.UserId,EventSourceId:n};o.post(r,function(){},function(){})};n.CardToShare={};n.share=function(){for(var i,r=[],f={},u=0;u<t.MyBusidex.length;u++)i=t.MyBusidex[u],i.Share&&(f={SharedCardId:0,CardId:i.CardId,SendFrom:t.User.UserId,SendFromEmail:"",Email:n.ShareWithEmail,ShareWith:0,SharedDate:new Date,Accepted:!1,Declined:!1,Recommendation:""},r.push(f),i.Share=!1);if(r.length==0)return alert("Please select at least one card to share"),!1;e.post(r,function(){n.ShareWithEmail="";n.SharedCardIds={};t.IsSharing=!1;alert("Your cards have been shared!")},function(){alert("There was a problem sharing your cards.")})};n.setShowControls=function(n,t){for(var i=0;i<n.length;i++)n[i]==t?t.ShowControls=!t.ShowControls:n[i].ShowControls=!1;return!1};n.toggleMobile=function(n){n.MobileView=!n.MobileView;u.update({id:n.UserCardId,isMobileView:n.MobileView})};n.RemoveCard=function(t,i){u.remove({id:i.CardId,userId:n.User.UserId},function(){for(var n=0;n<t.length;n++)if(t[n].CardId==i.CardId){t.splice(n,1);break}},function(){alert("There was a problem removing this card.")})};t.User==null?r.path()=="/busidex/mine"&&r.path("/account/login"):(t.ShowFilterControls=!0,t.MyBusidex==null||t.MyBusidex.length==0?u.get({all:!0},function(i){for(var r,o,e,f,u=0;u<i.MyBusidex.Busidex.length;u++){for(r=i.MyBusidex.Busidex[u].Card,i.MyBusidex.Busidex[u].OrientationClass=r.FrontOrientation=="V"?"v_preview":"h_preview",r.OwnerId!=t.User.UserId&&(r.OwnerId||r.CreatedBy!=t.User.UserId&&i.MyBusidex.Busidex[u].SharedById!=t.User.UserId)?i.MyBusidex.Busidex[u].Card.ShowEdit=!1:r.ShowEdit=!0,r.IconPath=r.OwnerId?"../img/searchIcon.png":"../img/phone.png",r.IconLink=r.OwnerId?"#"+r.CardId:"#/invite/"+r.CardId,r.IconClass=r.OwnerId?"HasOwner":"InMyBusidex",r.IconTitle=r.OwnerId?"In My Busidex":"Send an invite",o=[],e=0,e=0;e<r.Addresses.length;e++)f=r.Addresses[e],o.push(new Address(f.CardAddressId,f.CardId,f.Address1||"",f.Address2||"",f.City||"",f.State,f.ZipCode||""));r.Addresses=o;r.MapInfo="http://maps.google.com/maps?daddr={"+(r.Addresses.length>0?r.Addresses[0].Display():"")+"}";r.Share=!1;i.MyBusidex.Busidex[u].ShowControls=!1}t.MyBusidex=i.MyBusidex.Busidex;h.share&&t.ToggleSharing();n.Waiting=!1},function(t){n.resultData=t;n.Waiting=!1;n.Error=!0}):(n.IsSharing=!1,n.ToggleSharing=function(){n.IsSharing=!n.IsSharing},h.share&&t.ToggleSharing(),n.Waiting=!1))}function CardDetailCtrl(n,t,i,r,u,f,e,o,s,h){function a(i){if(t.User==null){r.path("/account/login");return}s.post({userId:t.User.UserId,cId:i},function(){alert("This card is now in your Busidex!");n.ExistsInMyBusidex=!0},function(){return alert("There was a problem adding this card to your Busidex"),!1})}var c,l;if(o.trackPage(r.path()),n.Card=null,n.ShowBack=!1,n.ShowFront=!1,t.ShowFilterControls=!1,n.BackOrientationClass="",n.FrontOrientationClass="",n.AddToMyBusidex=a,n.ExistsInMyBusidex=!1,c={id:e.CardId},isNaN(parseInt(c.id))){r.path("/home");return}l=function(n,i){var r={CardId:i,UserId:t.User!=null?t.User.UserId:null,EventSourceId:n};h.post(r,function(){},function(){})};t.EventSources==null?h.query({},function(n){t.EventSources=n.EventSources;l(t.EventSources.DETAILS,e.CardId)},function(){}):l(t.EventSources.DETAILS,e.CardId);n.Waiting=!0;u({method:"GET",url:ROOT+"/card/details/?id="+c.id,data:JSON.stringify(c),headers:{"Content-Type":"application/json","X-UserId":t.User!=null?t.User.UserId:0}}).success(function(i){n.FrontOrientationClass=i.Model.FrontOrientation=="V"?"v_preview":"h_preview";n.BackOrientationClass=i.Model.BackOrientation=="V"?"v_preview":"h_preview";n.UserId=t.User!=null?t.User.UserId:null;n.Card=i.Model;n.ShowBack=i.Model.HasBackImage&&i.Model.BackFileId!="b66ff0ee-e67a-4bbc-af3b-920cd0de56c6";n.ShowFront=i.Model.FrontFileId!=null;n.ExistsInMyBusidex=i.Model.ExistsInMyBusidex;n.Waiting=!1}).error(function(t,i){if(i==404){r.path("/home");return}n.resultData=t;alert("Getting card detail failed.");n.Waiting=!1})}function MyCardsCtrl(n,t,i,r,u,f,e,o,s,h,c,l){function nt(){n.PreviewBody=null}function tt(){var r=n.Model.ShareWith,i;[].push(n.MyCards[0].CardId);i={SharedCardId:0,CardId:n.MyCards[0].CardId,SendFrom:t.User.UserId,SendFromEmail:"",Email:r,ShareWith:0,SharedDate:new Date,Accepted:!1,Declined:!1,Recommendation:encodeURIComponent(n.PersonalMessage)};c.post(i,function(t){n.PreviewBody=t.Template.Body},function(){})}function it(){var i=encodeURIComponent(n.PersonalMessage),r={CardId:n.MyCards[0].CardId,SendFrom:t.User.UserId,Email:"",SharedDate:new Date,Accepted:null,Declined:null,Recommendation:i};s.sendTest(r,function(){n.Model.ShareWith="";v(n.EmailListString);alert("A sample email has been sent to your account email.")},function(){})}function rt(){var i,u;if(confirm("Send your card to all selected email addresses now?")){var f=0,r=[],e=new Date,o=encodeURIComponent(n.PersonalMessage);for(i=0;i<n.Contacts.length;i++)n.Contacts[i].Selected&&(f++,u={CardId:n.MyCards[0].CardId,SendFrom:t.User.UserId,Email:n.Contacts[i].Email,SharedDate:e,Accepted:null,Declined:null,Recommendation:o},r.push(u),n.Contacts[i].LastSharedDate=(new Date).toLocaleDateString());r.length>0&&s.post(r,function(){n.Model.ShareWith="";v(n.EmailListString);alert("Your Card Has Been Shared!")},function(){})}}function v(i){h.post({EmailList:i,UserId:t.User.UserId},function(t){var r,i;if(t.Communications!=null)for(r=t.Communications,i=0;i<n.Contacts.length;i++)r[n.Contacts[i].Email]!=null&&(n.Contacts[i].LastSharedDate=new Date(r[n.Contacts[i].Email].DateSent).toLocaleDateString())},function(){})}function ut(){n.SelectAll=!n.SelectAll;for(var t=0;t<n.Contacts.length;t++)n.Contacts[t].Selected=n.SelectAll}function ft(){$('<iframe id="logoutframe" src="https://accounts.google.com/logout" style="display: none"><\/iframe>').appendTo("body");setTimeout(y,2e3)}function et(t){var i=new FormData;i.append("file",t);l.post(i,function(t){for(var r,f,e=[],u=[],i=0;i<t.Contacts.length;i++)r=t.Contacts[i].FirstName+" "+t.Contacts[i].LastName,r==" "&&(r=t.Contacts[i].CompanyName),r.trim()==""&&(r="(No Name)"),f={Name:r,Email:t.Contacts[i].Email,Selected:!1,LastSharedDate:"(not available)"},u.push(f.Email),e.push(f);n.Contacts=e;n.EmailListString=u.join(",");p();v(u);n.AdvancedSharing=!n.AdvancedSharing},function(){})}function y(){function u(){gapi.auth.authorize({client_id:t,scope:r,immediate:!1},f)}function f(t){t&&!t.error&&$.get("https://www.google.com/m8/feeds/contacts/default/full?alt=json&access_token="+t.access_token+"&max-results=700&v=3.0",function(t){var i,f;n.ConnectedAccount=t.feed.author[0].email.$t;var r=t.feed.entry,e=[],u=[];for(i=0;i<r.length;i++)r[i].gd$email!=undefined&&r[i].gd$email[0]!=undefined&&(f={Name:r[i].title.$t,Email:r[i].gd$email[0].address.trim(),Selected:!1,LastSharedDate:"(not available)"},u.push(f.Email),e.push(f));n.$apply(function(){n.Contacts=e;n.EmailListString=u.join(",");p();v(u)})})}var t=API_ID,i=API_KEY,r="https://www.google.com/m8/feeds";gapi.client.setApiKey(i);window.setTimeout(u,3)}function ot(){n.ShowSelectedOnly=!n.ShowSelectedOnly}function p(){var t,i,r;if(!n.Sharing&&(t=[],t.push(n.MyCards[0]),i=!t[0].Name||t[0].Name.length==0,r=!t[0].CompanyName||t[0].CompanyName.length==0,i&&r)){alert("You have to fill in your card name or company before sharing.");return}n.Sharing=!n.Sharing}function st(){n.Sharing=!1}function ht(){var r=n.Model.ShareWith,i=[],u={CardId:n.MyCards[0].CardId,SendFrom:t.User.UserId,Email:r,SharedDate:new Date,Accepted:null,Declined:null,Recommendation:encodeURIComponent(n.PersonalMessage)};i.push(u);s.post(i,function(){n.Model.ShareWith="";alert("Your Card Has Been Shared!")},function(){});n.Sharing=!1}function ct(t){switch(t){case n.AdvancedSharingOptions.Gmail:n.AdvancedSharing=!n.AdvancedSharing;n.Model.SelectedSharingOption=n.AdvancedSharingOptions.Gmail;y();break;case n.AdvancedSharingOptions.Outlook:n.Model.SelectedSharingOption=n.AdvancedSharingOptions.Outlook;break;case n.AdvancedSharingOptions.Yahoo:n.Model.SelectedSharingOption=n.AdvancedSharingOptions.Yahoo;break;default:n.AdvancedSharing=!n.AdvancedSharing;n.Model.SelectedSharingOption={}}}function d(){u({method:"GET",url:ROOT+"/mycard/?id="+t.User.UserId,headers:{"Content-Type":"application/json"}}).success(function(i){for(var r=0;r<i.MyCards.length;r++)i.MyCards[r].FrontOrientationClass=i.MyCards[r].FrontOrientation=="V"?"v_preview":"h_preview",i.MyCards[r].BackOrientationClass=i.MyCards[r].BackOrientation=="V"?"v_preview":"h_preview",i.MyCards[r].ShowFront=i.MyCards[r].FrontFileId!=null,i.MyCards[r].ShowBack=i.MyCards[r].HasBackImage,b(i.MyCards[r].CardId);n.UserId=t.User.UserId;n.MyCards=i.MyCards;n.Waiting=!1;n.NoCards=i.MyCards.length==0;document.title=i.MyCards[0].Name+" | Busidex"}).error(function(t){n.resultData=t;alert("Getting My Cards failed.");n.Waiting=!1})}function lt(){n.CurrentMonthOffest--;n.CurrentMonth=w();b(n.MyCards[0].CardId)}function at(){n.CurrentMonthOffest++;n.CurrentMonth=w();b(n.MyCards[0].CardId)}function w(){var t=new Date,i;return t.setDate(1),t.setMonth(t.getMonth()+n.CurrentMonthOffest),i=g[t.getMonth()],{Name:i,Month:t.getMonth()+1,Year:t.getFullYear()}}function b(t){e.get({cardId:t,month:n.CurrentMonth.Month},function(t){n.Sources=t.Sources;n.MonthlyActivities=t.Activities.length>0?t.Activities[0].Data:{}},function(){})}var k,g,a;if(o.trackPage(r.path()),n.ShowPreviousMonth=lt,n.ShowNextMonth=at,n.ShowBack=!1,n.ShowFront=!1,n.Sharing=!1,n.SelectAll=!1,n.AdvancedSharing=!1,n.ShowSelectedOnly=!1,n.Model={},n.Model.ShareWith="",n.ShareMyCard=ht,n.ToggleSharing=p,n.ToggleAdvancedSharing=ct,n.ToggleShowSelected=ot,n.CancelSharing=st,n.ToggleSelectAll=ut,n.ShowPreview=tt,n.ShareWithAll=rt,n.SendTestEmail=it,n.SwitchAccounts=ft,n.ConnectedAccount="",n.PersonalMessage="",n.PreviewBody=null,n.ClosePreview=nt,n.AdvancedSharingOptions={Gmail:"Gmail",Yahoo:"Yahoo",Outlook:"Outlook"},n.Contacts=[],n.Model.OutlookFile="",n.LoadOutlookContacts=et,n.Model.SelectedSharingOption="",n.EmailListString="",n.Filter="",n.ReadContacts=y,t.ShowFilterControls=!1,t.SetCurrentMenuItem("Mine"),n.MonthlyActivities={},k=t.User!=null?parseInt(t.User.AccountTypeId):0,n.ShowActions=k!=ACCT_TYPE_BASIC,g=["January","February","March","April","May","June","July","August","September","October","November","December"],n.CurrentMonthOffest=0,n.CurrentMonth=w(),a=t.User,(a===null||a===undefined)&&(a=angular.fromJson(i.get("user")),t.User=a,manualLogin(a,n,t,i,u,s,r)),t.User===null||t.User===undefined){r.path("/account/login");return}n.Waiting=!0;d();n.DeleteCard=function(n){confirm("Are you sure you want to delete your card? Everyone with whom you have shared your card will no longer be able to see it.")&&f.remove({id:n,userId:t.User.UserId},function(){d()},function(){})}}function SuggestionsCtrl(n,t,i,r,u,f,e){e.trackPage(r.path());n.SuggestionInfo=[];n.Waiting=!0;f.get(function(t){n.Waiting=!1;n.SuggestionInfo=t.Suggestions;n.Suggestion=t.Model},function(){});n.save=function(){return n.Suggestion.CreatedBy=t.User!=null?t.User.UserId:0,f.post(n.Suggestion,function(t){n.SuggestionInfo=t.Suggestions;n.Suggestion=t.Model},function(){alert("Sorry, we had a problem saving your idea.")}),!0};n.vote=function(t){return f.update({id:t},function(t){n.SuggestionInfo=t.Suggestions;n.Suggestion=t.Model},function(){alert("Sorry, Vote not saved")}),!0}}function SearchCtrl(n,t,i,r,u,f,e,o,s,h){function a(){n.model.PrivateMessage="";n.model.SearchText="";n.model.SearchResultsMessage="";n.model.SearchModel.Results=[];n.model.ShowRIAR=!1}function v(i){n.Waiting=!0;_gaq.push(["_trackEvent","Search","Event",i]);e.searchByTag({systag:i},function(i){var f,u,r;if(n.Waiting=!1,n.model=i,n.model.TagSearch=!0,n.model.SearchText="",l(),n.UserId=t.User!=null?t.User.UserId:null,n.model.PrivateMessage="",f='The event for which you are searching is private. Only attendees may view this. If you did attend and are seeing this message, please email us at "busidex.help@gmail.com".',i&&i.SearchModel&&i.SearchModel.Results&&i.SearchModel.Results.length>0)for(u=0;u<i.SearchModel.Results.length;u++)r=i.SearchModel.Results[u],r.OwnerId!=null&&r.Searchable==!0?(r.HasOwner=!0,c(t.EventSources.SEARCH,r.CardId)):r.HasOwner=!1,r.FrontOrientationClass=r.FrontOrientation=="V"?"v_preview":"h_preview";else n.model.PrivateMessage=f;t.SearchModel=n.model},function(t){n.resultData=t;alert("Getting search results failed.");n.Waiting=!1})}function y(i){n.Waiting=!0;e.searchByOrganization({orgId:i},function(i){var u,r;if(n.Waiting=!1,n.model=i,n.model.TagSearch=!0,n.model.SearchText="",l(),i&&i.SearchModel&&i.SearchModel.Results)for(u=0;u<i.SearchModel.Results.length;u++)r=i.SearchModel.Results[u],r.HasOwner=!0,c(t.EventSources.SEARCH,r.CardId),r.FrontOrientationClass=r.FrontOrientation=="V"?"v_preview":"h_preview"},function(t){n.resultData=t;alert("Getting search results failed.");n.Waiting=!1})}function p(i){n.Waiting=!0;e.searchByGroupName({groupName:i},function(i){var u,r;if(n.Waiting=!1,n.model=i,n.model.TagSearch=!1,n.model.SearchText="",i&&i.SearchModel&&i.SearchModel.Results)for(u=0;u<i.SearchModel.Results.length;u++)r=i.SearchModel.Results[u],r.HasOwner=!0,c(t.EventSources.SEARCH,r.CardId),r.FrontOrientationClass=r.FrontOrientation=="V"?"v_preview":"h_preview"},function(t){n.resultData=t;alert("Getting search results failed.");n.Waiting=!1})}function w(){alert("Sorry, this card has not been activated.")}function l(){return(n.model.SearchResultsMessage="",n.model.TagSearch==!0)?n.model.SearchResultsMessage:(n.model.SearchResultsMessage=n.model.SearchModel.Results.length==0?"Your search for '"+n.model.SearchText.split(" ").join("+")+"' didn't return any results.":"We searched for anything containing '"+n.model.SearchText.split(" ").join("' or '")+"' and found "+n.model.SearchModel.Results.length+" cards!",n.model.SearchResultsMessage)}s.trackPage(r.path());n.IsLoggedIn=t.User!=null;t.IsLoggedIn=t.User!=null;t.ShowFilterControls=!1;t.SetCurrentMenuItem("Search");n.SearchByTag=v;n.SearchByOrganization=y;n.SearchByGroupName=p;n.Reset=a;n.ShowResultsMessage=l;n.ShowNoOwnerMessage=w;n.model={SearchText:"",Results:[]};n.model.TagSearch=!1;n.ShowLogo=function(t){a();t==="riarexpo"&&(n.model.ShowRIAR=!0)};n.dynamicImg="";n.popupCard=null;n.ShowAddLink=!1;n.Waiting=!1;t.SearchModel==null?(n.model.SearchModel={},n.model.SearchModel.Results=[]):n.model=t.SearchModel;var c=function(n,i){var r={CardId:i,UserId:t.User!=null?t.User.UserId:null,EventSourceId:n};o.post(r,function(){},function(){})};n.GoToDetails=function(n){setTimeout("goToDetails("+n+")",1e3)};n.GoToMyBusidex=function(){r.path("/busidex/mine")};h._t!=null?(v(h._t),_gaq.push(["_trackEvent","Search","Event",h._t])):h._o!=null?(y(h._o),_gaq.push(["_trackEvent","Search","Event",h._o])):h._g!=null&&(p(h._g),_gaq.push(["_trackEvent","Search","Event",h._g]));n.doSearch=function(){n.model.NoResults=!1;n.model.SearchModel.Results=[];n.model.SearchModel.Distance==0&&(n.model.SearchModel.Distance=25);n.Waiting=!0;n.model.SearchModel.UserId=t.User!=null?t.User.UserId:null;n.model.UserId=null;n.model.CardType=1;_gaq.push(["_trackEvent","Search","General",n.model.SearchText]);e.post(n.model,function(i){var u,r;for(n.Waiting=!1,n.model=i,n.model.TagSearch=!1,n.UserId=t.User!=null?t.User.UserId:null,n.model.SearchText=i.SearchModel.SearchText,u=0;u<i.SearchModel.Results.length;u++)r=i.SearchModel.Results[u],c(t.EventSources.SEARCH,r.CardId),r.OwnerId!=null&&r.Searchable==!0?(r.HasOwner=!0,c(t.EventSources.SEARCH,r.CardId)):r.HasOwner=!1,r.FrontOrientationClass=r.FrontOrientation=="V"?"v_preview":"h_preview";t.SearchModel=n.model;n.model.NoResults=n.model.SearchModel.Results.length==0;l()},function(t){n.resultData=t;alert("Getting search results failed.");n.Waiting=!1})};n.setPopupImage=function(i){if(!i.HasOwner)return!1;var r="https://az381524.vo.msecnd.net/cards/"+i.FrontFileId+"."+i.FrontFileType;n.dynamicImg=r;n.popupCard=i;n.ShowAddLink=!i.ExistsInMyBusidex;n.AddLinkMessage=(n.ShowAddLink?"Add to ":"View in ")+t.MyBusidexName;n.ViewBusidexLink=""};n.AddToMyBusidex=function(i){if(t.User==null){setTimeout("goToLogin()",1e3);return}f.post({userId:t.User.UserId,cId:i.CardId},function(){alert("This card is now in your Busidex!");i.ExistsInMyBusidex=!0;n.ViewBusidexLink="#/busidex/mine";n.ShowAddLink=!1},function(){return alert("There was a problem adding this card to your Busidex"),!1})}}function SharedCardCtrl(n,t,i,r,u,f,e,o){t.User=t.User||i.get("User");var s=t.User!=null?t.User.UserId:0;n.HasSharedCards=!1;t.User!=null&&u.get({},function(i){if(i.SharedCards&&i.SharedCards.length>0){t.HasSharedCards=!0;o(function(){f.path().indexOf("home")>=0&&$("#notificationPopup").modal("show")},2e3);t.SharedCards=[];for(var r=0;r<i.SharedCards.length;r++)t.SharedCards.push(i.SharedCards[r]);n.SendFromEmail=i.SharedCards[0].SendFromEmail}},function(){});n.AcceptSharedCards=function(){for(var r,c,o=[],h=[],i=n.$parent.SharedCards.length-1;i>=0;i--)r=n.$parent.SharedCards[i],r.Accepted=="true"&&(o.push(r.CardId),n.$parent.SharedCards.splice(i,1),n.SharedCards.splice(i,1)),r.Accepted=="false"&&(h.push(r.CardId),n.$parent.SharedCards.splice(i,1),n.SharedCards.splice(i,1));c={AcceptedCardIdList:o,DeclinedCardIdList:h,UserId:s,SharedWith:s};u.update({id:s},JSON.stringify(c),function(){n.$parent.SharedCards.length==0&&(t.HasSharedCards=n.HasSharedCards=!1);t.MyBusidex=[];f.path()=="/busidex/mine"?e.reload():f.path("/busidex/mine")},function(){})}}function ApplicationVersionCtrl(n,t){n.Version=t.Version}function FileUploadCtrl(n,t){n.model={name:"",comments:""};n.files=[];n.$on("fileSelected",function(t,i){n.$apply(function(){n.files.push(i.file)})});n.save=function(){t({method:"POST",url:ROOT+"/ImagePreview",headers:{"Content-Type":!1},transformRequest:function(n){var i=new FormData,t;for(i.append("model",angular.toJson(n.model)),t=0;t<n.files;t++)i.append("file"+t,n.files[t]);return i},data:{model:n.model,files:n.files}}).success(function(){alert("success!")}).error(function(){alert("failed!")})}}function PasswordRecoverCtrl(n,t,i,r,u){u.trackPage(i.path());n.Model={};n.Model.Email="";n.Model.Error=!1;n.Model.BadEmail=!1;n.EmailSent||(n.Model.SendEmail=function(){n.EmailSent=!0;r.update({email:n.Model.Email},function(){i.path("/account/recoversent")},function(t){t.status==400||t.status==404?n.Model.BadEmail=!0:n.Model.Error=!0})})}function PasswordResetCtrl(n,t,i,r,u,f,e,o,s){o.trackPage(i.path());n.Model={};n.Model.Email="";n.Model.Error=!1;n.Model.Password="";n.Model.ConfirmPassword="";n.Model.BadEmail=!1;n.Model.LoginData={UserName:"",Password:"",Token:"",AcceptSharedCards:!1,EventTag:"",TempData:u.data,RememberMe:!1};n.passwordsMatch=function(){return n.Model.Password===n.Model.ConfirmPassword&&n.Model.Password!==null&&n.Model.Password.length>0&&n.Model.ConfirmPassword!==null&&n.Model.ConfirmPassword.length>0};n.LoggedIn||(n.Model.Login=function(){n.LoggedIn=!0;n.Model.Password==n.Model.ConfirmPassword?(n.Model.LoginData.Password=n.Model.Password,n.Model.LoginData.UserName=n.Model.UserName,r.update(n.Model.LoginData,function(r){n.Waiting=!1;n.resultData=r;t.User=r;t.LoginModel={LoginText:t.User==null?"Login":"LogOut",LoginRoute:t.User==null?"#/account/login":"#/account/logout",HomeLink:t.User!=null&&t.User.StartPage=="Organization"?"#/groups/organization/"+t.User.Organizations[0].Item2:"#/home"};f.put("User",r);var u=t.User!=null?t.User.Token:null;s.defaults.headers.common["X-Authorization-Token"]=u;i.path("/home");t.IsLoggedIn=t.User!=null;e.get({},function(i){i.SharedCards&&i.SharedCards.length>0&&(t.HasSharedCards=!0,SharedCardList=i.SharedCards,n.SendFromEmail=i.SharedCards[0].SendFromEmail)},function(){})},function(){n.Model.Error=!0;n.LoggedIn=!1;n.Model.BadEmail=!0})):(n.Model.Error=!0,n.LoggedIn=!1)})}function UserNameRecoverCtrl(n,t,i,r,u){u.trackPage(i.path());n.Model={};n.Model.Email="";n.Model.BadEmail=!1;n.Model.Error=!1;n.Model.SendEmail=function(){r.post({email:n.Model.Email},function(){i.path("/account/recoversent")},function(t){t.status==400||t.status==404?n.Model.BadEmail=!0:n.Model.Error=!0})}}var GlobalCardCount=0,showMenu=!1,getGroup,GetCardCount=function(){GlobalCardCount=GlobalCardCount+1},Address=function(n,t,i,r,u,f,e){f==null&&(f={StateCodeId:0,Code:"",Name:""});var o=this;o.CardAddressId=n;o.CardId=t;o.Address1=i;o.Address2=r;o.City=u;o.State={StateCodeId:f.StateCodeId,Code:f.Code,Name:f.Name};o.ZipCode=e;o.Deleted=!1;o.DeleteSrc="../../img/delete.png";o.Display=function(){return o.Address1+" "+o.Address2+" "+o.City+" "+(o.State!=null?o.State.Code:"")+(o.ZipCode!=null&&o.ZipCode.length>0?", ":" ")+o.ZipCode};o.Selected=!1};GenericViewCtrl.$inject=["$http","$scope","$rootScope","$cookieStore","Activity"];AdminCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","$http","$sce"];AdminEditCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","$http"];GroupsCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","Groups","Analytics","Busigroup"];GroupDetailCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","$route","Busigroup","GroupNotes"];CreateGroupCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","$route","Busidex","Groups"];EditGroupCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","$route","Busidex","Groups","Busigroup"];OrganizationCtrl.$inject=["$http","$scope","$rootScope","$cookieStore","$location","$route","$routeParams","Organizations","$sce","$timeout","Busigroup","Groups","Search","FileUpload","SharedCard","Busidex"];AccountCtrl.$inject=["$scope","$rootScope","$cookieStore","Account","Users","$location","$routeParams","Analytics","AccountType","Settings","Password","UserName","$timeout"];DeleteAccountCtrl.$inject=["$scope","$rootScope","$cookieStore","Account","$location","Analytics"];RegistrationCompleteCtrl.$inject=["$scope","$rootScope","$cookieStore","$route","$routeParams","Registration","$location","Analytics","$http"];RegistrationViewCtrl.$inject=["$scope","$http","$rootScope","$cookieStore","Registration","$route","$routeParams","Users","$location","Analytics"];HomeViewCtrl.$inject=["$scope","$rootScope","$cookieStore","$http","$location","Feature","Busidex","$window"];LogoutViewCtrl.$inject=["$scope","$rootScope","$cookieStore","$location"];LoginPartialViewCtrl.$inject=["$scope","$rootScope","$cookieStore","$routeParams"];LoginViewCtrl.$inject=["$scope","$rootScope","$http","$cookieStore","$location","Login","SharedCard","$routeParams"];ConfirmCardCtrl.$inject=["$scope","$route"];AddCardCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","$http","$route","$routeParams","phoneNumberTypes","stateCodes","fileSizeInfoContent","Busidex","$timeout","Analytics","Account"];MyBusidexCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","Busidex","Notes","SharedCard","Activity","Analytics","$routeParams"];CardDetailCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","$http","$route","$routeParams","Analytics","Busidex","Activity"];MyCardsCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","$http","Card","Activity","Analytics","SharedCard","Communications","SharedCardPreview","OutlookContacts"];SuggestionsCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","$http","Suggestions","Analytics"];SearchCtrl.$inject=["$scope","$rootScope","$cookieStore","$location","$http","Busidex","Search","Activity","Analytics","$routeParams"];SharedCardCtrl.$inject=["$scope","$rootScope","$cookieStore","$http","SharedCard","$location","$route","$timeout"];ApplicationVersionCtrl.$inject=["$scope","ApplicationVersion"];PasswordRecoverCtrl.$inject=["$scope","$rootScope","$location","Users","Analytics"];PasswordResetCtrl.$inject=["$scope","$rootScope","$location","Login","$routeParams","$cookieStore","SharedCard","Analytics","$http"];UserNameRecoverCtrl.$inject=["$scope","$rootScope","$location","Users","Analytics"];
//# sourceMappingURL=controllers.min.js.map
